{"ast":null,"code":"'use strict';\n\nmodule.exports = function () {\n  var _this = this;\n  if (!this.imagePosition) {\n    this.imagePosition = {\n      x: 0,\n      y: 0,\n      width: 0,\n      height: 0\n    };\n  }\n  if (this.image.blendingMode) {\n    this.context.globalCompositeOperation = this.image.blendingMode;\n  }\n  if (this.imageNode) {\n    setImagePosition();\n    return;\n  }\n  this.imageNode = new Image();\n  this.imageNode.onerror = function () {\n    throw new Error('Granim: The image source is invalid.');\n  };\n  this.imageNode.onload = function () {\n    _this.imgOriginalWidth = _this.imageNode.width;\n    _this.imgOriginalHeight = _this.imageNode.height;\n    setImagePosition();\n    _this.refreshColorsAndPos();\n    if (!_this.isPausedWhenNotInView || _this.isCanvasInWindowView) {\n      _this.animation = requestAnimationFrame(_this.animateColors.bind(_this));\n    }\n    _this.isImgLoaded = true;\n  };\n  this.imageNode.src = this.image.source;\n  function setImagePosition() {\n    var i, currentAxis;\n    for (i = 0; i < 2; i++) {\n      currentAxis = !i ? 'x' : 'y';\n      setImageAxisPosition(currentAxis);\n    }\n    function setImageAxisPosition(axis) {\n      var canvasWidthOrHeight = _this[axis + '1'];\n      var imgOriginalWidthOrHeight = _this[axis === 'x' ? 'imgOriginalWidth' : 'imgOriginalHeight'];\n      var imageAlignIndex = axis === 'x' ? _this.image.position[0] : _this.image.position[1];\n      var imageAxisPosition;\n      switch (imageAlignIndex) {\n        case 'center':\n          imageAxisPosition = imgOriginalWidthOrHeight > canvasWidthOrHeight ? -(imgOriginalWidthOrHeight - canvasWidthOrHeight) / 2 : (canvasWidthOrHeight - imgOriginalWidthOrHeight) / 2;\n          _this.imagePosition[axis] = imageAxisPosition;\n          _this.imagePosition[axis === 'x' ? 'width' : 'height'] = imgOriginalWidthOrHeight;\n          break;\n        case 'top':\n          _this.imagePosition['y'] = 0;\n          _this.imagePosition['height'] = imgOriginalWidthOrHeight;\n          break;\n        case 'bottom':\n          _this.imagePosition['y'] = canvasWidthOrHeight - imgOriginalWidthOrHeight;\n          _this.imagePosition['height'] = imgOriginalWidthOrHeight;\n          break;\n        case 'right':\n          _this.imagePosition['x'] = canvasWidthOrHeight - imgOriginalWidthOrHeight;\n          _this.imagePosition['width'] = imgOriginalWidthOrHeight;\n          break;\n        case 'left':\n          _this.imagePosition['x'] = 0;\n          _this.imagePosition['width'] = imgOriginalWidthOrHeight;\n          break;\n      }\n      if (_this.image.stretchMode) {\n        imageAlignIndex = axis === 'x' ? _this.image.stretchMode[0] : _this.image.stretchMode[1];\n        switch (imageAlignIndex) {\n          case 'none':\n            break;\n          case 'stretch':\n            _this.imagePosition[axis] = 0;\n            _this.imagePosition[axis === 'x' ? 'width' : 'height'] = canvasWidthOrHeight;\n            break;\n          case 'stretch-if-bigger':\n            if (imgOriginalWidthOrHeight < canvasWidthOrHeight) break;\n            _this.imagePosition[axis] = 0;\n            _this.imagePosition[axis === 'x' ? 'width' : 'height'] = canvasWidthOrHeight;\n            break;\n          case 'stretch-if-smaller':\n            if (imgOriginalWidthOrHeight > canvasWidthOrHeight) break;\n            _this.imagePosition[axis] = 0;\n            _this.imagePosition[axis === 'x' ? 'width' : 'height'] = canvasWidthOrHeight;\n            break;\n        }\n      }\n    }\n  }\n};","map":{"version":3,"names":["module","exports","_this","imagePosition","x","y","width","height","image","blendingMode","context","globalCompositeOperation","imageNode","setImagePosition","Image","onerror","Error","onload","imgOriginalWidth","imgOriginalHeight","refreshColorsAndPos","isPausedWhenNotInView","isCanvasInWindowView","animation","requestAnimationFrame","animateColors","bind","isImgLoaded","src","source","i","currentAxis","setImageAxisPosition","axis","canvasWidthOrHeight","imgOriginalWidthOrHeight","imageAlignIndex","position","imageAxisPosition","stretchMode"],"sources":["D:/eci/web/node_modules/granim/lib/prepareImage.js"],"sourcesContent":["'use strict';\r\n\r\nmodule.exports = function() {\r\n\tvar _this = this;\r\n\r\n\tif (!this.imagePosition) {\r\n\t\tthis.imagePosition = { x: 0, y: 0, width: 0, height: 0 };\r\n\t}\r\n\r\n\tif (this.image.blendingMode) {\r\n\t\tthis.context.globalCompositeOperation = this.image.blendingMode;\r\n\t}\r\n\r\n\tif (this.imageNode) {\r\n\t\tsetImagePosition();\r\n\t\treturn;\r\n\t}\r\n\r\n\tthis.imageNode = new Image();\r\n\tthis.imageNode.onerror = function() {\r\n\t\tthrow new Error('Granim: The image source is invalid.');\r\n\t};\r\n\tthis.imageNode.onload = function() {\r\n\t\t_this.imgOriginalWidth = _this.imageNode.width;\r\n\t\t_this.imgOriginalHeight = _this.imageNode.height;\r\n\t\tsetImagePosition();\r\n\t\t_this.refreshColorsAndPos();\r\n\t\tif (!_this.isPausedWhenNotInView || _this.isCanvasInWindowView) {\r\n\t\t\t_this.animation = requestAnimationFrame(_this.animateColors.bind(_this));\r\n\t\t}\r\n\t\t_this.isImgLoaded = true;\r\n\t};\r\n\tthis.imageNode.src = this.image.source;\r\n\r\n\tfunction setImagePosition() {\r\n\t\tvar i, currentAxis;\r\n\r\n\t\tfor (i = 0; i < 2; i++) {\r\n\t\t\tcurrentAxis = !i ? 'x' : 'y';\r\n\t\t\tsetImageAxisPosition(currentAxis);\r\n\t\t}\r\n\r\n\t\tfunction setImageAxisPosition(axis) {\r\n\t\t\tvar canvasWidthOrHeight = _this[axis + '1'];\r\n\t\t\tvar imgOriginalWidthOrHeight = _this[axis === 'x' ? 'imgOriginalWidth' : 'imgOriginalHeight'];\r\n\t\t\tvar imageAlignIndex = axis === 'x' ? _this.image.position[0] : _this.image.position[1];\r\n\t\t\tvar imageAxisPosition;\r\n\t\t\tswitch(imageAlignIndex) {\r\n\t\t\t\tcase 'center':\r\n\t\t\t\t\timageAxisPosition = imgOriginalWidthOrHeight > canvasWidthOrHeight\r\n\t\t\t\t\t\t? -(imgOriginalWidthOrHeight - canvasWidthOrHeight) / 2\r\n\t\t\t\t\t\t: (canvasWidthOrHeight - imgOriginalWidthOrHeight) / 2;\r\n\t\t\t\t\t_this.imagePosition[axis] = imageAxisPosition;\r\n\t\t\t\t\t_this.imagePosition[axis === 'x' ? 'width' : 'height'] = imgOriginalWidthOrHeight;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'top':\r\n\t\t\t\t\t_this.imagePosition['y'] = 0;\r\n\t\t\t\t\t_this.imagePosition['height'] = imgOriginalWidthOrHeight;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'bottom':\r\n\t\t\t\t\t_this.imagePosition['y'] = canvasWidthOrHeight - imgOriginalWidthOrHeight;\r\n\t\t\t\t\t_this.imagePosition['height'] = imgOriginalWidthOrHeight;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'right':\r\n\t\t\t\t\t_this.imagePosition['x'] = canvasWidthOrHeight - imgOriginalWidthOrHeight;\r\n\t\t\t\t\t_this.imagePosition['width'] = imgOriginalWidthOrHeight;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 'left':\r\n\t\t\t\t\t_this.imagePosition['x'] = 0;\r\n\t\t\t\t\t_this.imagePosition['width'] = imgOriginalWidthOrHeight;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tif (_this.image.stretchMode) {\r\n\t\t\t\timageAlignIndex = axis === 'x' ? _this.image.stretchMode[0] : _this.image.stretchMode[1];\r\n\t\t\t\tswitch(imageAlignIndex) {\r\n\t\t\t\t\tcase 'none':\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 'stretch':\r\n\t\t\t\t\t\t_this.imagePosition[axis] = 0;\r\n\t\t\t\t\t\t_this.imagePosition[axis === 'x' ? 'width' : 'height'] = canvasWidthOrHeight;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'stretch-if-bigger':\r\n\t\t\t\t\t\tif (imgOriginalWidthOrHeight < canvasWidthOrHeight) break;\r\n\t\t\t\t\t\t_this.imagePosition[axis] = 0;\r\n\t\t\t\t\t\t_this.imagePosition[axis === 'x' ? 'width' : 'height'] = canvasWidthOrHeight;\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase 'stretch-if-smaller':\r\n\t\t\t\t\t\tif (imgOriginalWidthOrHeight > canvasWidthOrHeight) break;\r\n\t\t\t\t\t\t_this.imagePosition[axis] = 0;\r\n\t\t\t\t\t\t_this.imagePosition[axis === 'x' ? 'width' : 'height'] = canvasWidthOrHeight;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}